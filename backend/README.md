# CivicShield Backend

This directory contains the backend implementation for the CivicShield platform, built with Python and FastAPI.

## Table of Contents

1. [Overview](#overview)
2. [Technology Stack](#technology-stack)
3. [Project Structure](#project-structure)
4. [Getting Started](#getting-started)
5. [API Documentation](#api-documentation)
6. [Database Schema](#database-schema)
7. [Testing](#testing)
8. [Deployment](#deployment)

## Overview

The backend provides RESTful APIs for the CivicShield platform, handling user authentication, threat detection, incident management, and communication between agencies. It integrates with various data sources and provides real-time alerting capabilities.

## Technology Stack

- **Language**: Python 3.9+
- **Framework**: FastAPI
- **Database**: PostgreSQL with SQLAlchemy ORM
- **Caching**: Redis
- **Search**: Elasticsearch
- **Authentication**: JWT
- **Testing**: Pytest
- **Code Quality**: Black, Flake8, MyPy
- **Containerization**: Docker

## Project Structure

```
backend/
├── main.py              # Application entry point
├── database.py          # Database configuration
├── models/              # Database models
├── schemas/             # Pydantic schemas
├── routers/             # API routers
├── services/            # Business logic
├── utils/               # Utility functions
├── tests/               # Test suite
├── alembic/             # Database migrations
├── requirements.txt     # Production dependencies
├── requirements-dev.txt # Development dependencies
└── Dockerfile           # Docker configuration
```

## Getting Started

### Prerequisites

- Python 3.9+
- Docker and Docker Compose
- PostgreSQL (for local development)
- Redis (for local development)
- Elasticsearch (for local development)

### Installation

1. Clone the repository:
   ```bash
   git clone https://github.com/your-organization/civicshield.git
   cd civicshield/backend
   ```

2. Create a virtual environment:
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. Install dependencies:
   ```bash
   pip install -r requirements.txt
   pip install -r requirements-dev.txt
   ```

4. Set up environment variables:
   ```bash
   cp .env.example .env
   # Edit .env with your configuration
   ```

5. Run database migrations:
   ```bash
   alembic upgrade head
   ```

6. Start the development server:
   ```bash
   uvicorn main:app --reload
   ```

### Using Docker

1. Build the Docker image:
   ```bash
   docker build -t civicshield-backend .
   ```

2. Run the container:
   ```bash
   docker run -p 8000:8000 civicshield-backend
   ```

## API Documentation

The API documentation is automatically generated by FastAPI and can be accessed at:
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## Database Schema

The database schema is defined using SQLAlchemy ORM models in the `models/` directory. Migrations are managed using Alembic.

To create a new migration:
```bash
alembic revision -m "Description of changes"
```

To apply migrations:
```bash
alembic upgrade head
```

## Testing

Run the test suite using pytest:
```bash
pytest tests/
```

Run tests with coverage:
```bash
pytest --cov=src tests/
```

## Deployment

The backend can be deployed using Docker and Kubernetes. See the main project README for detailed deployment instructions.

### Environment Variables

The following environment variables are required for deployment:

- `DATABASE_URL`: PostgreSQL connection string
- `REDIS_URL`: Redis connection string
- `ELASTICSEARCH_URL`: Elasticsearch connection string
- `SECRET_KEY`: Application secret key
- `JWT_SECRET`: JWT secret key

### Health Checks

The backend provides health check endpoints:
- `/health`: General health check
- `/health/database`: Database connectivity check
- `/health/redis`: Redis connectivity check
- `/health/elasticsearch`: Elasticsearch connectivity check

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Run tests and linting
5. Submit a pull request

## License

This project is licensed under the MIT License - see the LICENSE file for details.